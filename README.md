# Bitrix Docker starter (PHP 8.1 / Nginx / MySQL)

## Состав
- `docker-compose.yml` — поднимает PHP-FPM 8.1, Nginx и MySQL 8.0.
- `docker/php` — Dockerfile с расширениями Bitrix, php.ini с опкод-кешем и заготовкой под Xdebug.
- `docker/nginx` — конфигурация виртуального хоста (`cds.localhost`).
- `docker/mysql` — типовые настройки сервера и utf8mb4.
- `www` — корень проекта Bitrix. Внутри уже лежит шаблон `local/templates/cds`, в который скопирован макет из `html_source`.

## Запуск окружения
1. Скопировать пример настроек: `cp .env.example .env` и при необходимости изменить пароли/порты.
2. Собрать и запустить контейнеры: `docker compose up -d --build`.
3. Установить 1C-Битрикс (редакция Старт/Стандарт) в каталоге `www` обычным мастером установки (через браузер или копированием готового ядра).
4. После установки добавить шаблон `cds` в настройках сайта и назначить его для главной страницы.
5. Для создания ИБ/HL-блоков и опций выполнить скрипт: `docker compose exec php php /var/www/html/local/scripts/setup_content.php`. Скрипт можно запускать повторно — он идемпотентен.
6. Чтобы наполнить демо-данными (направления, задачи, партнёры, новости, заявки), запустить: `docker compose exec php php /var/www/html/local/scripts/seed_demo.php`.

## Рекомендации по интеграции макета
- В шаблоне `local/templates/cds` разбейте `main.html` на `header.php`, `footer.php` и `template.php` согласно стандартам Bitrix. SVG-спрайт из конца файла можно оставить в `footer.php` или подключить отдельным инклюдом.
- CSS/JS подключайте через `Asset::getInstance()->addCss()`/`addJs()` либо через `template_styles.css`/`script.js`, чтобы соблюсти требования платформы.
- Заголовок и мета-теги задавайте через стандартные методы `$APPLICATION->SetTitle()` и `$APPLICATION->SetPageProperty()`.

### Динамические блоки и данные
| Блок | Реализация |
|------|------------|
|HERO|Отдельный highload-блок или простой `bitrix:main.include` с областями редактирования для текста, картинок и кнопок.|
|Наши направления|Инфоблок типа «Справочник». Фильтровать элементы по пользовательскому свойству «На главной» и выводить компонентом `news.list`. Заголовок блока держать в настройках компонента или `IncludeArea`.|
|Задачи фонда|Инфоблок со списком задач. Кнопки (текст+URL) редактируются через HL-блок настроек `cds_options`.|
|Заявки соискателей|Highload-блок `cds_applications` с флагом «На главной». Тексты кнопок («Помочь сейчас», «Узнать историю», «Спасибо, сбор закрыт») и CTA блока лежат в `cds_options`.|
|Благотворителям, Партнёры фонда, Новости|Отдельные инфоблоки. Для новостей используется сортировка по `SHOW_COUNTER` (кол-во показов) с ограничением `NEWS_COUNT=3`. Кнопки блоков редактируются через `cds_options`.|

### Управление контентом
- Все заголовки/описания блоков вынесены в `bitrix:main.include` (файлы `local/include/home/...`), поэтому их можно править через «Включаемые области» на странице.
- Тексты и ссылки кнопок (задачи, заявки, благотворителям, новости) и текст для карточек заявок хранятся в HL-блоке `Настройки CDS (cds_options)` — редактируются стандартной сеткой HL-блоков.
- Сами карточки блоков заполняются в соответствующих инфоблоках `cds_*`, заявки — в HL-блоке `cds_applications` (поля: имя, возраст, фото, суммы, статус, ссылка на историю).

### Прочие требования
- Навигацию, логотип и ссылки футера можно оставить статичными внутри шаблона.
- После установки настройте модуль «Главный» (временная зона, кодировка, домен).
- Включите композитное или обычное кеширование компонентов и проверьте страницу с включённым кешем (`Настройки > Настройки продукта > Производительность > Управление кешем`).

## Полезные команды
```bash
# остановить окружение
docker compose down

# просмотреть логи
docker compose logs -f php
```
